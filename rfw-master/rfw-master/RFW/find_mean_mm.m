function [meannew iter time allmeannew] =find_mean_mm(A,init,K)% author: T. Zhang% input A: A{1}, A{2},..., A{n} are the PSD matrices% input init: initization of the algorithm% output meannew: the karcher mean% output time: running time at each iteration% output allmeannew: record of the matrices at all iterations tic; toc_rec=0;  N=length(A); D=size(A{1},1); meannew=init; meanold=meannew+eye(D); for i=1:N    [U,S]=eig(A{i});    C1{i}=U*diag(diag(S).^-0.5)*U';    C2{i}=U*diag(diag(S).^0.5)*U';    %C1{i}=A{i}^-0.5;    %C2{i}=A{i}^0.5;enditer=1;grad(1)=0;%while norm(meanold-meannew,'fro')>10^-14 & iter<100toc_rec=toc_rec+toc;while iter<Ktic;meanold=meannew;B1=zeros(D,D);B2=zeros(D,D);for i=1:Ntemp1=C1{i}*meanold*C1{i};%A_i^-0.5*X_k*A_i^-0.5[U,S]=eig(temp1);S0=diag(S);logS0=log(S0);S1=((logS0.^2+1).^0.5-logS0).*S0;S2=((logS0.^2+1).^0.5+logS0).*(S0.^-1);B1=B1+C2{i}*U*diag(S1)*U'*C2{i};%f1B2=B2+C1{i}*U*diag(S2)*U'*C1{i};%f2end [U,S]=eig(B2);S0=diag(S);S1=(S0).^0.5;S2=(S0).^-0.5;meannew=U*diag(S2)*(diag(S1)*U'*B1*U*diag(S1))^0.5*diag(S2)*U';allmeannew{iter}=meannew;toc_rec=toc_rec+toc;time(iter)=toc_rec;%time(iter)=iter;iter=iter+1;end